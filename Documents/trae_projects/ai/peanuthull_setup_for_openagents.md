# 使用花生壳配置OpenAgents内网穿透指南

## 步骤1：登录花生壳控制台
1. 打开浏览器，访问花生壳官方网站或控制台地址
2. 使用您的花生壳账号登录

## 步骤2：修改或创建花生壳映射

### 方案A：修改现有映射（推荐）
从您提供的截图中，我看到您已经有一个名为"Ollama"的映射配置：
- 外部地址：`http://t1nz171374pe64.vicp.fan:38952`
- 内网地址：`192.168.91.179:11434`

1. 找到这个"Ollama"映射并点击"编辑"按钮
2. 将**内网地址**的端口从 `11434` 改为 `8700`（保持IP地址 `192.168.91.179` 不变）
3. 可选：将映射名称改为"OpenAgents"以避免混淆
4. 点击"保存"按钮应用更改

### 方案B：创建新映射
如果您想保留原有的Ollama映射，可以创建一个新的映射：
1. 点击"添加映射"按钮
2. 设置映射信息：
   - 映射名称：`OpenAgents`
   - 映射类型：`HTTP`
   - 内网地址：`192.168.91.179:8700`
3. 点击"保存"按钮创建映射

## 步骤3：获取花生壳外部URL

保存映射后，花生壳会为您提供一个外部URL，格式类似于：
`http://t1nz171374pe64.vicp.fan:38952`

请记录这个URL，您将在OpenAgents控制台中使用它。

## 步骤4：在OpenAgents控制台中发布网络

1. 打开OpenAgents控制台：https://openagents.org/dashboard/networks/publish
2. 正确配置以下参数：
   - **网络ID**：您的网络唯一标识符（如 `production-network-1`）
   - **网络名称**：您的网络显示名称（如 `Production Learning Assistant Network`）
   - **网络主持人**：花生壳提供的外部域名（如 `t1nz171374pe64.vicp.fan`，不需要添加 `http://` 前缀）
   - **网络端口**：花生壳提供的外部端口（如 `38952`）
3. 点击提交按钮完成发布

## 步骤5：验证连接

完成发布后，OpenAgents控制台会进行健康检查，确认网络连接正常。

您也可以手动验证花生壳映射是否正常工作：
1. 在浏览器中访问花生壳提供的外部URL：`http://t1nz171374pe64.vicp.fan:38952/api/health`
2. 如果看到包含 `"success": true` 的JSON响应，表示映射配置成功

## 常见问题排查

1. **健康检查失败**：
   - 确认花生壳映射已正确指向 `192.168.91.179:8700`
   - 确认OpenAgents网络正在本地运行（可通过 `curl http://localhost:8700/api/health` 验证）

2. **外部URL无法访问**：
   - 检查花生壳客户端是否在线
   - 确认本地防火墙已允许端口 `8700` 的访问
   - 尝试重启花生壳客户端

3. **端口冲突**：
   - 确保端口 `8700` 未被其他程序占用
   - 如果需要，可以修改OpenAgents网络配置使用不同的端口，然后更新花生壳映射

## 注意事项

- 花生壳的免费版本可能有流量限制，建议根据您的需求选择合适的套餐
- 花生壳的域名可能会定期更换（免费版本），如果需要长期稳定的域名，建议升级到付费版本
- 确保OpenAgents网络配置中的 `host` 和 `port` 与花生壳映射一致