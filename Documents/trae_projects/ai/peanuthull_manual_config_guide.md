# 花生壳手动配置指南

## 服务器状态确认

通过命令行检查，您的本地服务器状态如下：

1. **端口监听状态**：
   ```
   TCP    0.0.0.0:8700           0.0.0.0:0              LISTENING
   ```
   ✅ 服务器在8700端口正常监听

2. **本地IP地址**：
   ```
   IPv4地址: 192.168.85.179
   ```
   ✅ 本地IP地址与之前花生壳配置中使用的IP一致

## 花生壳手动配置步骤

根据您提供的花生壳"基础设置"界面截图，由于快速扫描未发现常用服务，需要手动配置内网服务：

### 步骤1：填写内网主机

在"内网主机"输入框中，手动输入您的本地IP地址：

```
192.168.85.179
```

### 步骤2：设置内网端口

1. 确保"内网端口"下拉菜单选择为"自定义"
2. 在右侧输入框中输入端口号：

```
8700
```

### 步骤3：保存配置

1. 点击界面右下角的"保存"或"应用"按钮
2. 等待配置生效（通常需要几秒钟）

### 步骤4：检查连接状态

配置完成后，返回花生壳的主界面，检查诊断信息：

- 确认`内网服务`显示：`192.168.85.179:8700`（连接成功）
- 等待`域名指向IP`更新为您的实际公网IP（108.181.22.243）
- 确认错误信息`域名指向IP与服务器不一致`消失

### 步骤5：测试外部访问

配置完成后，测试外部访问是否正常：

```powershell
# 使用花生壳域名测试
curl.exe -s http://1nz171374pe64.vicp.fun:8700/api/health

# 或使用公网IP直接测试
curl.exe -s http://108.181.22.243:8700/api/health
```

## 常见问题排查

### 如果配置后仍然无法访问：

1. **重启花生壳客户端**：
   - 关闭花生壳应用程序
   - 等待30秒后重新打开
   - 再次检查诊断信息

2. **检查Windows防火墙**：
   - 确保防火墙允许8700端口的入站连接
   - 检查是否有针对Python应用程序的防火墙规则

3. **验证本地服务器状态**：
   ```powershell
   # 检查服务器是否正在运行
   tasklist | findstr "python"
   
   # 测试本地访问
   curl.exe -s http://localhost:8700/api/health
   ```

4. **尝试使用不同的端口**：
   - 如果8700端口被ISP或防火墙阻止，可以尝试使用其他端口（如8080、9000等）
   - 需要同时在服务器配置（network.yaml）和花生壳中更新端口

## 预期结果

成功配置后，您应该能够通过花生壳域名从外部访问您的服务器：

```json
{"status": "healthy", "timestamp": "...", "components": {...}}
```

如果您在配置过程中遇到任何问题，请随时提供最新的截图或错误信息，我将进一步协助您解决。