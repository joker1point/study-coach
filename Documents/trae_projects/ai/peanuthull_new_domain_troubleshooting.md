# 花生壳新域名故障排除指南

## 问题概述
新花生壳域名 `1nz171374pe64.vicp.fun` 已成功DNS解析到IP地址 `115.236.153.172`，但外部无法访问OpenAgents网络服务。

## 已完成的检查

### ✅ DNS解析测试
```
nslookup 1nz171374pe64.vicp.fun
# 结果：成功解析到 115.236.153.172
```

### ✅ 本地服务状态
```
# 本地健康检查
curl.exe -s http://localhost:8700/api/health
# 结果：服务正常运行，返回健康状态
```

### ✅ 网络配置更新
- 已更新 `network.yaml` 配置文件
- 已重启OpenAgents网络服务
- 新配置已成功加载

## 可能的问题原因

### 1. 花生壳端口映射配置错误
请检查花生壳客户端中的端口映射配置：

#### 检查步骤：
1. 打开花生壳客户端
2. 点击「内网穿透」或「端口映射」
3. 找到对应域名 `1nz171374pe64.vicp.fun` 的映射规则
4. 确认配置如下：
   - **应用名称**：任意名称（如OpenAgents）
   - **内网主机**：本地IP地址（如192.168.x.x）
   - **内网端口**：8700
   - **映射类型**：HTTP
   - **外网端口**：8700（或花生壳分配的端口）
   - **状态**：已启用

### 2. 花生壳客户端未在线
请确保：
- 花生壳客户端正在运行
- 客户端已登录并显示「在线」状态
- 没有登录超时或连接问题

### 3. 防火墙设置阻止外部访问
请检查：
- Windows防火墙是否允许端口8700的入站连接
- 路由器防火墙是否允许外部访问
- 网络环境是否有额外的安全限制

#### Windows防火墙检查步骤：
1. 打开「控制面板」→「系统和安全」→「Windows Defender 防火墙」
2. 点击「高级设置」
3. 选择「入站规则」→「新建规则」
4. 规则类型选择「端口」→「下一步」
5. 选择「TCP」→「特定本地端口」，输入8700→「下一步」
6. 选择「允许连接」→「下一步」
7. 选择应用场景（建议全选）→「下一步」
8. 输入规则名称（如OpenAgents HTTP）→「完成」

### 4. 网络环境限制
- 部分网络（如公司网络、校园网络）可能限制外部端口访问
- 某些ISP可能封锁了常用端口或限制了花生壳服务

## 临时解决方案：使用ngrok
如果花生壳问题无法立即解决，可以使用ngrok作为临时替代方案：

### 安装ngrok
1. 访问 https://ngrok.com/ 注册账号
2. 下载并安装ngrok客户端
3. 运行 `ngrok config add-authtoken <your_auth_token>` 配置认证令牌

### 启动ngrok
```bash
ngrok http 8700
```

### 使用ngrok地址
ngrok会生成一个临时域名（如 https://abc123.ngrok.io），可以直接用于OpenAgents控制台发布。

## 后续建议

1. **等待花生壳配置生效**：花生壳端口映射可能需要几分钟才能完全生效
2. **重启花生壳客户端**：尝试重启花生壳客户端刷新配置
3. **联系花生壳支持**：如果问题持续存在，可以联系花生壳技术支持
4. **检查OpenAgents控制台**：确保在OpenAgents控制台中使用的是正确的域名和端口

## 技术支持信息

- **本地服务地址**：http://localhost:8700
- **网络ID**：production-network-1
- **花生壳域名**：1nz171374pe64.vicp.fun
- **花生壳IP**：115.236.153.172
- **配置端口**：8700

如果需要进一步帮助，请提供花生壳客户端的配置截图和系统防火墙设置信息。